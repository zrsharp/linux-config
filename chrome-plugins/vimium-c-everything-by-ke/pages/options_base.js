"use strict";var t,u,s,w,x,y,O,R,S,N,_,J,T;"".includes||(function(){var t=String.prototype;"".startsWith||(t.startsWith=function(t){return 0===this.lastIndexOf(t,0)},t.endsWith=function(t){var n=this.length-t.length;return n>=0&&this.indexOf(t,n)===n}),t.includes=function(t,n){return this.indexOf(t,n)>=0}})(),t=function(t){return document.querySelector(t)},u=chrome.extension.getBackgroundPage(),s=chrome.i18n.getMessage,w=document.querySelectorAll.bind(document),(x=chrome.i18n.getMessage("lang1"))&&(function(){var n,i,e,o,u=s("keyMappingsP"),r=t("#keyMappings");for(u&&r&&(r.placeholder=u),n=0,i=w("[data-i]");n<i.length;n++)((u=s((r=i[n]).dataset.i))||r.dataset.iE)&&(r.innerText=u);for(e=0,o=w("[data-i-t]");e<o.length;e++)(u=s((r=o[e]).dataset.iT))&&(r.title=u);document.documentElement.lang=x,(u=s("vOptions"))&&(document.title=u)})(),y=function(t,n){var i=function(){this.constructor=t};i.prototype=n.prototype,t.prototype=new i},O=(function(){var t=[],n=function(){var i,e,o=t.length;for(i=0,e=t;i<e.length;i++)(0,e[i])();t.length>o?(t.splice(0,o),Promise.resolve().then(n)):t.length=0};return function(i,e){t.length<=0&&Promise.resolve().then(n),9===e?t.unshift(i):t.push(e?i.bind(null,e):i)}})(),R=function(t,n,i,e){var o,u=0,r=function(){var s=Date.now()-o;if(!(s<n-4&&s>=0))return u=0,o!==e?t.call(i):void 0;u=setTimeout(r,n-s)};return e=e?1:0,function(){if(o=Date.now(),!u)return u=setTimeout(r,n),e?(e=o,t.call(i)):void 0}},S=u.f,N=u.l,_=(function(){function t(t,n){this.Jr=t,this.th=t.id,this.al=this.nh=null,this.ih=false,this.th in N.zc&&(n=this.eh.bind(this,n)),this.nh=R(n,330,this,1)}return t.prototype.oh=function(){},t.prototype.uh=function(){this.ih=true,this.al=N.Nc(this.th),t.rh||this.sh(this.al)},t.prototype.ch=function(t,n,i){var e=this.fh;return n?(i=e||!i?JSON.stringify(e?e.ah(t):t):i,u.JSON.parse(i)):e?e.ah(t):t},t.prototype.lh=function(){return true},t.prototype.hh=function(){var n=this.dh(),i="object"==typeof n,e=i?JSON.stringify(this.al):this.al,o=i?JSON.stringify(n):n;o!==e&&(e=o,n=this.ch(n,i,i?o:""),i&&(o=JSON.stringify(n))===JSON.stringify(N.Mc[this.th])&&(n=N.Mc[this.th]),N.Pc(this.th,n),this.al=n=N.Nc(this.th),this.ih=true,e!==(i?JSON.stringify(n):n)&&this.sh(n,true),this.th in N.zc&&t.vh.push(this.th),this.oh())},t.mh=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},t.hg=Object.create(null),t.rh=true,t})(),J=(function(n){function i(e,o){var u=n.call(this,e,o)||this;return u.ph=_.mh,u.wh=false,N.Kc("exclusionTemplate",function(){var n,e,o,r,c,f,a,l=document.createElement("div");if(l.innerHTML=N._.exclusionTemplate,u.k=l.querySelector("#exclusionTemplate").content.firstChild,x){for(n=void 0,e=void 0,o=0,r=l.querySelectorAll("[data-i]");o<r.length;o++)(e=s((n=r[o]).dataset.i))&&(n.innerText=e);for(c=0,f=u.k.querySelectorAll("[title]");c<f.length;c++)(e=s((n=f[c]).title))&&(n.title=e)}u.xh=l.querySelector("tbody"),u.d_=[],u.xh.addEventListener("input",i.gh),u.xh.addEventListener("input",u.nh),u.xh.addEventListener("click",function(t){return u.yh(t)}),t("#exclusionAddButton").onclick=function(){return u.Oh("")},(a=l.firstElementChild).remove(),u.k.remove(),_.vh&&(u.k.draggable=true),u.wh=true,u.ih&&O(function(){return u.sh(u.al)}),O(function(t){return u.Jr.appendChild(t)},a),O(function(){return u.bh&&u.bh()})}),u}return y(i,n),i.prototype.kh=function(){},i.gh=function(t){var n=t.target.vnode;n&&(n.Rh=true)},i.prototype.Oh=function(t,n){this.Sh(this.xh,{pattern:t,passKeys:""});var i=this.d_[this.d_.length-1];false!==n&&O(function(){return i.Nh.focus()}),t&&this.nh(),this.kh(1)},i.prototype.sh=function(t){if(this.wh){if(this.xh.textContent="",this.d_=[],t.length<=0);else if(1===t.length)this.Sh(this.xh,t[0]);else{var n=document.createDocumentFragment();t.forEach(this.Sh.bind(this,n)),this.xh.appendChild(n)}return this.kh(t.length)}},i.prototype._h=function(){return true},i.prototype.Sh=function(t,n){var i,e,o,u,r,s=n.pattern,c=n.passKeys,f={Jh:{pattern:s,passKeys:c},Rh:false,hf:false,Nh:null,Th:null};this._h(s)?(e=(i=document.importNode(this.k,true)).querySelector(".pattern"),o=i.querySelector(".passKeys"),u=c.trimRight(),e.value=s,s&&(e.placeholder=""),o.value=u,u&&(o.placeholder=""),(r=f).hf=true,r.Nh=e,r.Th=o,e.vnode=r,o.vnode=r,this.d_.push(r),t.appendChild(i)):this.d_.push(f)},i.Ph=function(t){t.Jh.pattern&&t.Th.placeholder&&(t.Th.placeholder="")},i.prototype.yh=function(t){var n,i=t.target;if(i.classList.contains("exclusionRemove"))return(i=i.parentNode.parentNode).classList.contains("exclusionRule")?(n=i.querySelector(".pattern").vnode,i.remove(),this.d_.splice(this.d_.indexOf(n),1),this.nh(),this.kh(0)):void 0},i.prototype.dh=function(t){var n,i,e,o,r,s,c,f,a,l,h=[];for(t=true===t,n=0,i=this.d_;n<i.length;n++)e=i[n],t&&!e.hf||(e.Rh?(o=e.Nh.value.trim(),r=false,s=e.Th.value,o?((c=o.startsWith(":")?0:o.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(o)?o.startsWith("^")||(r=!o.includes("/",c+3),o=(c<0?"^https?://":"^")+(o.startsWith("*")&&"."!==o[1]?"[^/]"+o:(o=o.replace(/\./g,"\\.")).startsWith("*")?o.replace("*\\.","(?:[^./]+\\.)*?"):o.replace("://*\\.","://(?:[^./]+\\.)*?"))):(r=!o.includes("/",c+3)&&!o.startsWith("vimium:"),o=(c<0?":http://":":")+(o=o.replace(/\\(.)/g,"$1")))),r&&(o+="/"),s&&((f=(s=u.r.cc(s)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z][\da-z]+|[^\sA-Z])>|\S/g))&&((a="^"===f[0]&&f.length>1)&&f.shift(),f.sort(),a?f.unshift("^"):"^"===f[0]&&(f.shift(),f.push("^"))),s=(s=f?f.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),e.Th.title!==(l=s?s.length>1&&"^"===s[0]?"only hook such keys":"pass through such keys":"completely disabled")&&(e.Th.title=l),this.$h(e,o,s),h.push(e.Jh)):this.$h(e,"",s)):e.Jh.pattern&&h.push(e.Jh));return h},i.prototype.$h=function(t,n,e){var o=!t.Jh.passKeys&&!!e;t.Jh={pattern:n,passKeys:e},t.Rh=false,o&&i.Ph(t)},i.prototype.oh=function(){var t,n,i,e;for(t=0,n=this.d_;t<n.length;t++)(i=n[t]).hf&&(i.Nh.value!==i.Jh.pattern&&(i.Nh.value=i.Jh.pattern),e=i.Jh.passKeys.trim(),i.Th.value!==e&&(i.Th.value=e))},i})(_),T=S<48||devicePixelRatio<2&&S>=61?function(){var t=document.createElement("style"),n=devicePixelRatio,i=S>=61&&n>=1,e=i||S>=48?1/n:1;e=(""+(e+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=i?"input, textarea { border-width: "+e+"px; }":"* { border-width: "+e+"px !important; }",document.head.appendChild(t)}:null,location.pathname.toLowerCase().includes("/popup.html")&&Promise.all([u.r.$a("Exclusions"),u.r.sc(1),N.Qc&&N.Qc()]).then((function(t){return function(){chrome.tabs.query({currentWindow:true,active:true},t)}})(function(n){function i(t){var n,i,e=3===A,o=e?m.g(R,p):m.m(R,p,Z.dh(true));o&&(o=(function(t){var n,i,e,o;for((n=(t=t.trim()).startsWith("^"))&&(t=t.slice(1).trimLeft()),i=Object.create(null),e=0,o=t.split(" ");e<o.length;e++)i[o[e]]=1;return(n?"^ ":"")+Object.keys(i).sort().join(" ")})(o)),t&&($=A>=2?o:null),A=2,n=o===$,i=!!o&&o.length>2&&"^"===o[0],x.textContent=(e?o?s("o137")+s(i?"o138":"o139"):s("o140"):s(n?"o141":"o142")+s(o?i?"o138":"o139":n?"o143":"o143_2")).replace(" to be","")+s("colon")+(o?s("NS"):""),b.className=o?"code":"fixed-width",b.textContent=o?i?o.slice(2):o:s(null!==o?"o144":"o145")+s("o146"),k.textContent=M&&!e&&n?s("o147",[s(0!==j?"o144":"o145")]):M?s("o148"):"",g.disabled=n,g.firstChild.data=s(n?"o115":"o115_2")}function e(){if(!g.disabled){var t=m.e;u.a.ls("reset silent",p.t),Z.hh(),setTimeout(function(){m.e=t},50),A=3,i(true),g.firstChild.data=s("o115_3"),g.disabled=true,P=true}}function o(t,n){n&&n.preventDefault(),u.a.ls(t.toLowerCase(),p.t),window.close()}var r,c,f,a,l,h,d,v,m,p,w,x,g,b,k,R,S,P,$,j,A,L,K,D,E,U,z,M,W,B,Z,q=n[0],C=q.url,F=u.a.Ac(q.id),G=t("#blocked-msg"),H=!(F||q&&C&&"loading"===q.status&&/^(ht|s?f)tp/.test(C));if(H?(r=document.body,c=document.documentElement,r.innerText="",G.style.display="",G.querySelector(".version").textContent=N.aa.ql,f=G.querySelector("#refresh-after-install"),q&&C&&/^(ht|s?f)tp/i.test(C)||f.remove(),r.style.width="auto",r.appendChild(G),null==(l=(a=C.startsWith(location.protocol)&&!C.startsWith(location.origin)?new URL(C).host:"")?N.Ic[a]:null)||l||((h=t("#injection-refused")).style.display="",h.nextElementSibling.remove(),t("#doAllowExt").onclick=function(){var t,n=N.Nc("extAllowList"),i=n.split("\n"),e=a;i.indexOf(e)<0&&(t=i.indexOf("# "+e)+1||i.indexOf("#"+e)+1,i.splice(t?t-1:i.length,t?1:0,e),n=i.join("\n"),N.Pc("extAllowList",n)),this.onclick=null,chrome.tabs.query({active:true,currentWindow:true},function(t){var n=function(){return setTimeout(function(){return location.reload()},500),chrome.runtime.lastError};return t&&t[0]?chrome.tabs.reload(t[0].id,n):chrome.tabs.reload(n),chrome.runtime.lastError})}),c.classList.toggle("auto-dark",!!N.Sc.d),c.style.height=""):O(function(t){G.remove(),G=null;var n=document.documentElement.classList;n.toggle("auto-dark",!!N.Sc.d),n.toggle("less-motion",!!N.Sc.m),t.textContent=N.aa.ql},t(".version")),(d=t(".options-link")).href!==(v=N.aa.Ql)&&(d.href=v),d.onclick=function(t){t.preventDefault();var n=u.Object.create(null);n.u=N.aa.Ql,u.a.xr(n),window.close()},!H){for(m=u.Exclusions,p=!F||F[0].s.i&&!u.r.pa.test(F[0].s.u)?{i:0,a:q.incognito,s:0,f:0,t:q.id,u:C}:F[0].s,w=p.i&&((u.a.Ac(q.id,0)||{}).s||{}).u||"",x=t("#state-action"),g=t("#saveOptions"),k=(b=x.nextElementSibling).nextElementSibling,R=p.u,S=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return y(n,t),n.prototype.Oh=function(i,e){t.prototype.Oh.call(this,n.jh(),e)},n.prototype._h=function(t){if(!t)return false;var n=m.e[t];return!(1===n.t?!R.startsWith(n.v)||w&&!w.startsWith(n.v):!n.v.test(R)||w&&!n.v.test(w))},n.prototype.sh=function(e){var o,u,r,s;t.prototype.sh.call(this,e),(o=this).wh&&(o.sh=null,document.documentElement.style.height="",n.prototype._h=J.prototype._h,u=o.d_.filter(function(t){return t.hf}),A=(r=u.length>0)?2:1,r?(s=u[0].Th,i(true)):(o.Oh("",false),s=o.d_[o.d_.length-1].Th),O(function(){return s.focus()}))},n.prototype.$h=function(n,i,e){var o,u,r=n.Jh.pattern===i;t.prototype.$h.call(this,n,i,e),r||(o=m.r(i,""),u=n.Nh,(1===o.t?R.startsWith(o.v):o.v.test(R))?u.title=u.style.color="":(u.style.color="red",u.title="Red text means that the pattern does not\nmatch the current URL."))},n.jh=function(){var t=R.startsWith("http:")?"^https?://"+R.split("/",3)[2].replace(/[.[\]]/g,"\\$&")+"/":R.startsWith(location.origin)?":vimium:/"+new URL(R).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(R)&&!R.startsWith("file:")?":"+R.split("/",3).join("/")+"/":":"+R;return n.jh=function(){return t},t},n})(J),P=true,$=null,j=-1,A=0,g.onclick=e,document.addEventListener("keyup",function(t){if(13===t.keyCode&&(t.ctrlKey||t.metaKey)&&(setTimeout(window.close,300),!P))return e()}),L=N.Nc("exclusionRules"),K=m.e=u.Object.create(null),D=m.As,E=0,U=L.length;E<U;E++)K[L[E].pattern]=D[E];z=2!==p.s?"Disable":"Enable",j=(M=!!(1&p.f))?p.s:-1,W=t("#toggleOnce"),B=W.nextElementSibling,O(function(){W.firstElementChild.textContent=(s(z)||z)+(M?"":s("Once")),W.onclick=o.bind(null,z),b.id="state-value",M?(B.classList.remove("hidden"),B.firstElementChild.onclick=o.bind(null,"Reset")):B.remove()}),N.Sc.o||window.addEventListener("keydown",function(t){t.altKey&&(88===t.keyCode||M&&90===t.keyCode)&&!(t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.stopImmediatePropagation(),o(88===t.keyCode?z:"Reset"))}),_.rh=false,Z=null,(Z=new S(t("#exclusionRules"),function(){if(P){P=false;var n=t("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),g.removeAttribute("disabled"),g.firstChild.data=s("o115_2")}i(A<2)})).uh(),window.onunload=function(){m.e=null,u.r.sc(-1)},T&&O(T)}}));