"use strict";function t(n){(n?addEventListener:removeEventListener)("wheel",u,{passive:false,capture:true})}function u(n){n.ctrlKey&&(n.preventDefault(),n.stopImmediatePropagation(),L(n))}function s(){var n=J.scrollWidth;Q.style.height=J.scrollHeight+"px",Q.style.width=n+"px",Q.style.display=""}function w(n,e){var t,i;if(e.preventDefault(),VData.url){for(i in t=document.createElement("a"),n)t.setAttribute(i,n[i]);t.href=VData.url,y(t,e)}}function y(n,e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",true,true,window,1,0,0,0,0,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),n.dispatchEvent(t)}function I(n){var e,t,i,r;if(VData.error)return false;if(e=n.keyCode,"space"===(i=(t=window.VKey&&VKey._?VKey.ct({c:" ",e:n,i:e},8):32===e?"space":13===e?"enter":"").slice(t.lastIndexOf("-")+1)||t&&"-")||"enter"===i)return n.preventDefault(),"enter"===i&&en&&en.isShown&&!en.played?en.play(true):en&&en.isShown||y(J,n),true;switch(r=0,t){case"c-=":case"m-=":case"+":case"=":case"up":r=1;break;case"left":r=-2;break;case"right":r=2;break;case"c--":case"m--":case"-":case"down":r=-1;break;default:return false}return n.preventDefault(),n.stopImmediatePropagation(),en&&en.viewed?R(en,r):$().then(F).then(function(n){R(n,r)}).catch(P),true}function R(n,e){2===e||-2===e?n.rotate(45*e):n.zoom(e/10,true)}function _(n,e){try{n=(e||decodeURIComponent)(n)}catch(n){}return n}function x(n){var e=W("#bodyTemplate"),t=document.importNode(e.content.querySelector("#"+n),true);return document.body.insertBefore(t,e),t}function L(n){if(n.altKey)return n.stopImmediatePropagation(),w({download:VData.file||""},n);switch(VData.type){case"url":w({target:"_blank"},n);break;case"image":if(VData.error)return;$().then(F).catch(P)}}function U(n){n.preventDefault(),J.onclick&&J.onclick(n)}function A(n,e){n="number"==typeof n?["math","copy","search","ERROR","status","paste","url"][n]:n,W("#textTip").dataset.text=Y("t_"+n)||n,W(".colon").dataset.colon=Y("colon")+Y("NS");var t=W("#textBody");return e?(t.textContent="string"!=typeof e?e.join(" "):e,J.onclick=S):t.classList.add("null"),s()}function S(n){var e;""+getSelection()||("image"===VData.type&&VData.url&&(e=navigator.clipboard)&&e.write?(null!=un?Promise.resolve(un):fetch(VData.url,{cache:"force-cache",referrer:"no-referrer"}).then(function(n){return n.blob()}).catch(function(){return T(VData.url),0}).then(function(n){return un=n})).then(function(n){return n&&e.write([new ClipboardItem({"image/png":new Blob([n],{type:"image/png"}),"text/plain":new Blob([VData.url],{type:"text/plain"})})])}).catch(function(n){console.log(n),T(VData.url)}):T("url"===VData.type?W("#textBody").textContent:VData.url,n))}function T(n,e){n&&window.VApi&&(e&&e.preventDefault(),VApi.Bt({H:16,s:n}))}function z(n){"image"===VData.type&&(VData.error||en&&en.isShown?n.preventDefault():J.classList.toggle("invert"))}function C(n,e){return window[n]?Promise.resolve(window[n]):window[n]=new Promise(function(t){var i=document.createElement("script");i.src=e,i.onload=function(){var e=window[n];t(e)},document.head.appendChild(i)})}function E(n){if(!W('link[href="'+n+'"]')){var e=document.createElement("link");e.rel="stylesheet",e.href=n,document.head.insertBefore(e,W('link[href$="show.css"]'))}}function P(n){n&&console.log("%o",n)}function $(){return window.Viewer?Promise.resolve(Viewer):(E("../lib/viewer.min.css"),C("Viewer","../lib/viewer.min.js").then(function(n){return n.setDefaults({navbar:false,shown:function(){Q.style.display="none"},viewed:function(){nn&&(t(false),nn(true))},hide:function(){Q.style.display="",t(true),nn&&nn(false)}}),n}))}function F(n){var e,t=scrollX||scrollY,i=getSelection();return"Range"===i.type&&i.collapseToStart(),(e=en=en||new n(J)).isShown||e.show(),t&&scrollTo(0,0),e.viewed?e:new Promise(function(n,t){nn=function(i){nn=null,i?n(e):t("failed to view the image")}})}function V(){H(),Promise.resolve().then(function(){un=null}),"image"===VData.type&&(document.body.classList.remove("filled"),J.removeAttribute("src"),en&&(en.destroy(),en=null))}function B(n){function e(n){try{return new URL(n)}catch(n){}return null}function t(n){try{n=decodeURIComponent(n||"")}catch(n){}return n}var i,r,o,u,a,c,l,f,s,d,h,w,m,g,p,v,b,y=e(n);if(!y||!/^(ht|s?f)tp/i.test(y.protocol))return null;if(i=y.origin,r=y.pathname,(o=y.search).length>10)for(u=0,a=o.slice(1).split("&");u<a.length;u++)if(l=(c=a[u]).split("=",1)[0],(s=f=c.slice(l.length+1)).length>7)if(!s.includes("://")&&/%(?:3[aA]|2[fF])/.test(s)&&(s=t(s).trim()),s.includes("/")&&null!=e(s)){if(/^(?:imgurl|mediaurl|objurl|origin(?:al)?|real\w*|src|url)$/i.test(l))return s;if(d=s.split("?")[0].split("/"),rn.test(d[d.length-1])&&!/\bthumb/i.test(l))return s}else if("id"===l&&/&w=\d{2,4}&h=\d{2,4}/.test(o))return i+r+"?id="+f;if(h=null,(h=/[?&]s=\d{2,4}(&|$)/.exec(o))&&o.split("=").length<=3)return i+r;if(w=(o=r).lastIndexOf("/")+1,p=null,g=(m=(o=o.slice(w)).lastIndexOf("@")+1||o.lastIndexOf("!")+1)>2||rn.test(o)){for(w+=m,o=o.slice(m),v=/(?:[.\-_]|\b)(?:[1-9]\d{2,3}[a-z]{1,3}[_\-]?|[1-9]\d?[a-z][_\-]?|0[a-z][_\-]?|[1-9]\d{1,3}[_\-]|[1-9]\d{1,2}(?=[.\-_]|\b)){2,6}(?=[.\-_]|\b)/gi;p=v.exec(o);h=p);h&&/.[_\-].|\d\dx\d/i.test(h[0])?(p=rn.exec(o.slice(h.index+h[0].length)),b=h[0].length,p&&0===p.index&&(b+=p[0].length),o=r.slice((w+=h.index)+b),/[@!]$/.test(o||r.charAt(w-1))?o?o=o.slice(0,-1):w--:o||!p||0!==p.index||rn.test(r.slice(Math.max(0,w-6),w))||(o=p[0])):(h=/\b([\da-f]{8,48})([_-][a-z]{1,2})\.[a-z]{2,4}$/.exec(o))?(w+=h.index+h[1].length,o=o.slice(h.index+h[1].length+h[2].length)):g=false}return g||m>2?g=g||0:(h=/_(0x)?[1-9]\d{2,3}(x0)?\./.exec(o))?o=o.slice(0,h.index)+o.slice(h.index+h[0].length-1):o.startsWith("thumb_")?o=o.slice(6):/^[1-9]\d+$/.test(o)&&+o>0&&+o<640?(w--,o=""):g=0,0!==g?i+r.slice(0,w)+o:null}function M(n){var e,t,i,r;if(n&&!/.\.[a-z]{3,4}\b/i.test(n)){if(e=rn.exec(VData.url))return n+e[0];if((t=un?un.type.toLowerCase():"").startsWith("image/"))for(r in i={jpeg:"jpg",png:0,bmp:0,svg:0,gif:0,tif:0,ico:0})if(i.hasOwnProperty(r)&&t.includes(r))return i[r]||"."+r}}function q(n,e){var t,i=new Text,r=document.body,o=function(){e.removeEventListener("load",o),e.removeEventListener("error",o),clearInterval(t),i.remove(),t=0};e.addEventListener("load",o,true),e.addEventListener("error",o,true),(VData.incognito||X.l.Nc("showInIncognito")||n.startsWith("data:"))&&/^(ht|s?f)tp|^data:/i.test(n)&&window.fetch&&"cache"in Request.prototype?(H(),r.replaceChild(i,e),fetch(n,{cache:"no-store",referrer:"no-referrer"}).then(function(n){return n.blob()}).then(function(n){return on=URL.createObjectURL(un=n)},function(){return n}).then(function(n){e.src=n,r.replaceChild(e,i)})):e.src=n,t=setInterval(function(){e.scrollHeight>=24||e.scrollWidth>=80?o():i.parentNode||(r.insertBefore(i,e),i.data=Y("loading")||"loading\u2026")},400)}function H(){on&&(URL.revokeObjectURL(on),on="")}function Z(n){var e=n.split(":",1)[0];switch(e.toLowerCase()){case"thunder":case"flashget":case"qqdl":n=n.slice(e.length+3).split("&",1)[0];break;default:return""}try{n=atob(n)}catch(n){return""}return n.startsWith("AA")&&n.endsWith("ZZ")&&(n=n.slice(2,-2)),n.startsWith("[FLASHGET]")&&n.endsWith("[FLASHGET]")&&(n=n.slice(10,-10)),Z(n)||n}function G(){console.log("Failed to visit the predicted URL, so go back to the original version."),K(),VData.auto=false,window.onhashchange()}function K(){var n=false;return"once"===VData.auto&&(VData.auto=false,n=true),n&&O(),n}function O(n){var e,t,i=VData.type;i&&(e="#!"+i+" "+(VData.incognito?"incognito=1&":"")+(VData.file?"download="+encodeURIComponent(VData.file)+"&":"")+(VData.auto?"auto="+("once"===VData.auto?"once":1)+"&":"")+VData.original,VData.full=e,n||(t=D(e,tn,true),history.replaceState(t,"","")))}function D(n,e,t){var i,r,o,u;if(-1===e)return n;if(i=[],t)n=encodeURIComponent(n);else try{n=atob(n)}catch(e){n=""}for(r=0,o=n;r<o.length;r++)i.push(o[r].charCodeAt(0));for(u=0;u<i.length;u++)i[u]=255&(i[u]^e>>>8*(3&u));if(n=String.fromCharCode.apply(String,i),t)n=btoa(n);else try{n=decodeURIComponent(n)}catch(e){n=""}return n}function N(n){return VData.full?location.href.split("#",1)[0]+VData.full:n}var W,X,Y,J,Q,nn,en,VData,tn,rn,on,un;W=function(n){return document.querySelector(n)},X=chrome.extension&&chrome.extension.getBackgroundPage(),Y=chrome.i18n.getMessage,X&&X.r&&X.r.ba||(X=null),J=null,Q=W("#bgLink"),nn=null,en=null,VData=null,tn=+window.name||0,rn=/\.(bmp|gif|icon?|jpe?g|a?png|tiff?|webp)(?=[.\-_]|\b)/i,on="",un=null,chrome.i18n.getMessage("lang1")&&(document.title=Y("vDisplay")||document.title),window.onhashchange=function(){var n,e,i,r,o,u,a,c,l,f,d,h;for(J&&(V(),Q.style.display="none",J.remove(),J=null,t(false)),(VData=Object.create(null)).cu=N,e="",i="",!(n=location.hash)&&X&&X.l&&X.l.mc.kc?(n=X.l.mc.kc(),/^[^:]+[ &]data:/i.test(n)&&(tn=-1),r=D(n,tn=tn||Math.floor(4294967296*Math.random())||3286711320,true),history.state?history.pushState(r,"",""):history.replaceState(r,"",""),window.name=""+tn):n||!history.state||(tn?(n=D(history.state,tn,false),window.name=""+tn):history.replaceState(null,"","")),VData.full=n,n.length<3||(n.startsWith("#!image")?(n=n.slice(7),e="image"):n.startsWith("#!url")&&(n=n.slice(5),e="url")),n=n.startsWith("%20")?n.slice(3):n.trim(),o=0;o=n.indexOf("&")+1;n=n.slice(o))if(a=(u=n.slice(0,o).indexOf("="))>0?n.slice(0,u):"",c=u>0?n.slice(u+1,o-1):"","download"===a)i=(i=_(c).split(/\||\uff5c| [-\xb7] /,1)[0].trim()).replace(/[\r\n"]/g,""),VData.file=i;else if(c=c.toLowerCase(),"auto"===a)VData.auto="once"===c?c:"true"===c||"false"!==c&&parseInt(c,10)>0;else{if("incognito"!==a)break;VData.incognito="true"===c||"false"!==c&&parseInt(c,10)>0}switch((n=_(n,n.includes(":")||n.includes("/")?decodeURI:null).trim())?n.toLowerCase().startsWith("javascript:")?e=n=i=VData.file="":X?(l=X.r.ba(n,null,-2),X.r.ga<=2&&(n=l)):n.startsWith("//")?n="http:"+n:/^([-.\dA-Za-z]+|\[[\dA-Fa-f:]+])(:\d{2,5})?\//.test(n)&&(n="http://"+n):"image"===e&&(e=""),VData.type=e,/^data:/i.test(n)&&(n="data:"+n.slice(5)),VData.url=VData.original=n,e){case"image":VData.auto&&(f=B(n))&&(console.log("Auto predict a better URL:\n %o =>\n %o",n,f),n=VData.url=f),(J=x("shownImage")).onerror=function(){VData.url!==VData.original&&VData.url?G():(K(),VData.auto=false,this.onerror=this.onload=null,this.alt=VData.error=Y("failInLoading")||"\xa0(fail in loading)\xa0",X&&X.l&&X.f>=60&&this.classList.add("broken"),setTimeout(s,34),this.onclick=function(n){n.ctrlKey||n.shiftKey||n.altKey||!chrome.tabs||!chrome.tabs.update?w({target:"_top"},n):chrome.tabs.update({url:VData.url})})},/[:.]/.test(n)?(J.onclick=L,J.onload=function(){var n=this.naturalWidth;if(n<12&&this.naturalHeight<12){if(VData.auto)return void G();if(n<2&&this.naturalHeight<2)return console.log("The image is too small to see."),void this.onerror(null)}VData.original=VData.url,K(),VData.url.startsWith("data:")&&!this.src.startsWith("data")&&(Q.dataset.vimUrl=VData.original=VData.url=this.src,O(1)),this.onerror=this.onload=null,this.src.startsWith("blob:")||setTimeout(function(){J.src=J.src},0),s(),this.classList.add("zoom-in"),n>=.9*innerWidth&&document.body.classList.add("filled")},q(n,J)):(n=VData.url="",J.onerror(null),J.alt=VData.error=Y("none")||"\xa0(null)\xa0"),i&&(VData.file=i=M(i)||i,(d=i.split(/[/\\]+/)).length>1&&J.setAttribute("download",d[d.length-1]),J.alt=i,J.title=i),t(true);break;case"url":if(J=x("shownText"),n&&X){if(h=null,n.startsWith("vimium://")&&(h=X.r.wa(n.slice(9),1,true)),"string"==typeof(h=null!==h?h:X.r.ba(n,null,-1)))h=X.r.Na(h),h=X.r.Za(h);else{if(h instanceof X.Promise){h.then(function(n){A(n[1],n[0]||n[2]||"")});break}if(h instanceof X.Array){A(h[1],h[0]);break}}n=h}"string"==typeof n&&(n=Z(n)||n),A(e,n);break;default:n="",(J=x("shownImage")).src="../icons/icon128.png",Q.style.display="none",t(true)}Q.dataset.vimUrl=n,i?(Q.dataset.vimText=i,Q.download=i):(Q.removeAttribute("data-vim-text"),Q.removeAttribute("download")),Q.onclick=J?U:L},"".includes||(function(){var n=String.prototype;"".startsWith||(n.startsWith=function(n){return 0===this.lastIndexOf(n,0)},n.endsWith=function(n){var e=this.length-n.length;return e>=0&&this.indexOf(n,e)===e}),n.includes=function(n,e){return this.indexOf(n,e)>=0}})(),window.onhashchange(),window.onpopstate=function(){window.onhashchange()},window.onunload=H,document.addEventListener("keydown",function(n){if(("image"!==VData.type||!I(n))&&(n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey&&!n.repeat){var e=String.fromCharCode(n.keyCode);if("S"===e)return w({download:VData.file||""},n);if("C"!==e)return"A"===e?z(n):void 0;S(n)}});